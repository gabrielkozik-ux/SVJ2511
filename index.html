<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hlasovací Systém SVJ - v3.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .checkbox-lg { transform: scale(1.3); cursor: pointer; }
        .checkbox-xl { transform: scale(1.6); cursor: pointer; }
        .modal { transition: opacity 0.25s ease; }
        body.modal-active { overflow: hidden; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen pb-20">

    <!-- Sticky Header -->
    <div class="sticky top-0 z-40 bg-white shadow-lg border-b border-gray-300">
        
        <!-- Resolution / Mode Selector -->
        <div id="top-bar" class="bg-blue-900 text-white p-3 transition-colors duration-500">
            <div class="container mx-auto flex flex-col xl:flex-row justify-between items-center gap-3">
                
                <!-- Main Controls -->
                <div class="flex flex-col md:flex-row items-center gap-2 w-full xl:w-auto">
                    <div class="flex items-center gap-2 w-full">
                        <span class="font-bold whitespace-nowrap text-sm md:text-base"><i class="fas fa-gavel mr-2"></i>Bod:</span>
                        <select id="resolution-select" class="text-gray-900 text-sm rounded block w-full p-2 border-none focus:ring-2 focus:ring-blue-500 max-w-md" onchange="changeMainResolution()">
                            <!-- Options by JS -->
                        </select>
                    </div>
                    
                    <!-- Amendment Button -->
                    <button onclick="openAmendmentModal()" class="whitespace-nowrap bg-orange-500 hover:bg-orange-600 text-white text-xs md:text-sm font-bold py-2 px-3 rounded shadow border border-orange-600 flex items-center gap-1">
                        <i class="fas fa-pen-fancy"></i> Navrhnout změnu
                    </button>

                     <!-- Legal Help Button -->
                     <button onclick="toggleModal('legal-modal')" class="whitespace-nowrap bg-gray-600 hover:bg-gray-700 text-white text-xs md:text-sm font-bold py-2 px-3 rounded shadow flex items-center gap-1">
                        <i class="fas fa-balance-scale"></i> Právní tahák
                    </button>
                </div>

                <!-- Active Mode Indicator -->
                <div class="flex items-center gap-2">
                    <div id="amendment-indicator" class="hidden bg-orange-100 text-orange-800 px-3 py-1 rounded font-bold text-sm border border-orange-300 animate-pulse">
                        <i class="fas fa-exclamation-circle"></i> REŽIM POZMĚŇOVACÍHO NÁVRHU
                    </div>
                    <div class="text-xs bg-blue-800 px-3 py-1 rounded border border-blue-700" id="quorum-info">
                        Kvórum: > 50%
                    </div>
                </div>
            </div>
            
            <!-- Context Sub-header (shows specifically what we are voting on NOW) -->
            <div class="container mx-auto mt-2 pt-2 border-t border-blue-800 flex justify-between items-center">
                <div class="font-mono text-sm text-blue-200">
                    Hlasujeme o: <span id="current-voting-title" class="font-bold text-white text-lg">...</span>
                </div>
                <button id="cancel-amendment-btn" onclick="cancelAmendmentMode()" class="hidden text-xs text-orange-200 hover:text-white underline">
                    Zrušit návrh a vrátit se k bodu
                </button>
            </div>
        </div>

        <!-- Live Results Bar -->
        <div class="container mx-auto px-4 py-3 bg-white">
            <div class="flex flex-col md:flex-row items-center gap-4 justify-between">
                
                <!-- Stats -->
                <div class="grid grid-cols-3 gap-4 w-full md:w-auto text-center divide-x divide-gray-300">
                    <div class="px-2">
                        <div class="text-[10px] text-gray-500 uppercase font-bold tracking-wider">Přítomno</div>
                        <div class="font-mono font-bold text-gray-700">
                            <span id="present-shares">0</span><span class="text-gray-400 text-sm">/733</span>
                        </div>
                    </div>
                    <div class="px-2">
                        <div class="text-[10px] text-gray-500 uppercase font-bold tracking-wider">PRO</div>
                        <div class="font-mono font-bold text-blue-600">
                            <span id="yes-votes">0</span>
                        </div>
                    </div>
                    <div class="px-2 flex flex-col justify-center">
                        <div id="result-badge" class="px-2 py-1 rounded text-white font-bold text-lg bg-gray-400">
                            0.0 %
                        </div>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div class="flex-grow w-full md:w-auto relative pt-1">
                    <div class="flex mb-2 items-center justify-between">
                        <div class="text-right w-full">
                            <span id="status-text" class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded text-gray-600 bg-gray-200">
                                Čekání
                            </span>
                        </div>
                    </div>
                    <div class="overflow-hidden h-4 mb-1 text-xs flex rounded bg-gray-200 border border-gray-300 relative">
                        <div id="quorum-marker" class="absolute top-0 bottom-0 w-0.5 bg-black z-10 opacity-50 border-l border-dashed border-gray-600" style="left: 50%" title="Potřebná hranice"></div>
                        <div id="progress-bar" style="width:0%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-500 transition-all duration-500"></div>
                    </div>
                </div>

                <!-- Action Button -->
                <div>
                    <button onclick="saveRound()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded shadow-lg transition flex items-center gap-2 transform hover:scale-105">
                        <i class="fas fa-save"></i> <span>UZAVŘÍT HLASOVÁNÍ</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Grid -->
    <div class="container mx-auto px-4 py-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <!-- Left Column: Voting Table -->
        <div class="lg:col-span-2 space-y-4">
            
            <!-- Quick Tools -->
            <div class="flex justify-between items-center bg-white p-3 rounded shadow-sm border border-gray-200">
                <div class="flex gap-2">
                    <button onclick="toggleAllPresence(true)" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-800 px-3 py-1.5 rounded transition border border-gray-300">
                        Všichni přítomni
                    </button>
                    <button onclick="toggleAllPresence(false)" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-800 px-3 py-1.5 rounded transition border border-gray-300">
                        Nikdo
                    </button>
                </div>
                <div class="flex gap-2">
                    <button onclick="toggleAllVotes(true)" class="text-xs bg-blue-50 hover:bg-blue-100 text-blue-800 px-3 py-1.5 rounded transition font-bold border border-blue-200">
                        Všichni PRO
                    </button>
                    <button onclick="toggleAllVotes(false)" class="text-xs bg-red-50 hover:bg-red-100 text-red-800 px-3 py-1.5 rounded transition border border-red-200">
                        Zrušit hlasy
                    </button>
                </div>
            </div>

            <!-- Table -->
            <div class="bg-white rounded-lg shadow overflow-hidden border border-gray-200">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-gray-800 text-white text-sm uppercase sticky top-0">
                        <tr>
                            <th class="p-3 w-10 text-center">#</th>
                            <th class="p-3">Vlastník</th>
                            <th class="p-3 w-20 text-center">Podíl</th>
                            <th class="p-3 w-24 text-center bg-gray-700 cursor-pointer" onclick="toggleAllPresence(true)">
                                <i class="fas fa-walking"></i> Přít.
                            </th>
                            <th class="p-3 w-24 text-center bg-blue-900 cursor-pointer" onclick="toggleAllVotes(true)">
                                <i class="fas fa-vote-yea"></i> PRO
                            </th>
                        </tr>
                    </thead>
                    <tbody id="owners-table" class="divide-y divide-gray-200 text-sm">
                        <!-- JS Generated -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Right Column: History -->
        <div class="lg:col-span-1 space-y-6">
            <div class="bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden">
                <div class="bg-gray-50 px-4 py-3 border-b border-gray-200 font-bold text-gray-700 flex justify-between items-center">
                    <span><i class="fas fa-history mr-2"></i>Zápis hlasování</span>
                    <button onclick="clearHistory()" class="text-xs text-red-400 hover:text-red-600">Smazat</button>
                </div>
                <div class="max-h-[600px] overflow-y-auto p-0 bg-gray-50">
                    <div id="history-list" class="divide-y divide-gray-200">
                        <!-- History Items -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: Amendment -->
    <div id="amendment-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto">
            <div class="modal-content py-4 text-left px-6">
                <div class="flex justify-between items-center pb-3">
                    <p class="text-2xl font-bold text-orange-600">Nový pozměňovací návrh</p>
                    <div class="cursor-pointer z-50" onclick="closeAmendmentModal()">
                        <i class="fas fa-times"></i>
                    </div>
                </div>
                <div class="my-5">
                    <p class="text-sm text-gray-600 mb-2">Jak zní navrhovaná změna?</p>
                    <textarea id="amendment-text" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-orange-500" rows="3" placeholder="Např.: V článku 5 změnit částku na 2000 Kč..."></textarea>
                    
                    <p class="text-sm text-gray-600 mt-4 mb-2">Vyžadované kvórum pro změnu:</p>
                    <select id="amendment-threshold" class="w-full p-2 border border-gray-300 rounded bg-gray-50">
                        <option value="50">Nadpoloviční většina přítomných (>50%) - Standard</option>
                        <option value="75">Tříčtvrteční většina (>75%) - Bezpečnější</option>
                    </select>
                </div>
                <div class="flex justify-end pt-2">
                    <button onclick="startAmendmentVoting()" class="px-4 bg-orange-500 p-3 rounded-lg text-white hover:bg-orange-600 font-bold">Zahájit hlasování o změně</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: Legal Cheat Sheet -->
    <div id="legal-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50" onclick="toggleModal('legal-modal')"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-2xl mx-auto rounded shadow-lg z-50 overflow-y-auto max-h-[90vh]">
            <div class="modal-content py-4 text-left px-6">
                <div class="flex justify-between items-center pb-3 border-b">
                    <p class="text-xl font-bold text-gray-800"><i class="fas fa-balance-scale mr-2"></i>Právní postup při změnách</p>
                    <button onclick="toggleModal('legal-modal')" class="text-gray-500 hover:text-gray-800"><i class="fas fa-times fa-lg"></i></button>
                </div>
                <div class="my-4 text-sm text-gray-700 space-y-3">
                    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-3">
                        <p class="font-bold">Základní pravidlo:</p>
                        <p>Nehlasujte rovnou o "nových stanovách". Musíte se k nim propracovat přes <strong>hlasování o dílčích změnách</strong>.</p>
                    </div>
                    
                    <h3 class="font-bold text-lg mt-4">Postup krok za krokem:</h3>
                    <ol class="list-decimal pl-5 space-y-1">
                        <li><strong>Přednesení změny:</strong> Někdo navrhne: <em>"V článku X vypustit větu Y..."</em></li>
                        <li><strong>Hlasování o změně:</strong> Hlasuje se POUZE o této změně (většinou >50% přítomných).</li>
                        <li><strong>Výsledek:</strong> 
                            <ul class="list-disc pl-5 text-gray-500">
                                <li>Pokud projde: Návrh stanov se v tomto bodě mění.</li>
                                <li>Pokud neprojde: Zůstává původní text z pozvánky.</li>
                            </ul>
                        </li>
                        <li><strong>Finální hlasování:</strong> Až se vyřeší všechny změny, hlasuje se o <strong>Stanovách jako celku</strong> (ve znění přijatých změn).</li>
                    </ol>

                    <div class="bg-red-50 border-l-4 border-red-500 p-3 mt-4">
                        <p class="font-bold text-red-700">RIZIKO: Nepřítomní vlastníci</p>
                        <p>Pokud změníte podstatu návrhu (např. způsob placení), může to nepřítomný vlastník napadnout u soudu, protože "hlasoval per rollam" nebo dal plnou moc pro původní text. <br><strong>Doporučení:</strong> Na schůzi dělat jen upřesňující, ne koncepční změny.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const initialResolutions = [
            { id: 1, title: "1. Volba předsedy (J. Kislenko) a zapisovatele", threshold: 50 },
            { id: 2, title: "2. Schválení nových stanov SVJ", threshold: 75, highlight: true },
            { id: 3, title: "3. Volba výboru SVJ (5 let)", threshold: 50 },
            { id: 4, title: "4. Schválení účetní závěrky 2024", threshold: 50 },
            { id: 5, title: "5. Schválení výše měsíčních příspěvků", threshold: 50 },
            { id: 6, title: "6. Schválení odměny výboru (1.000 Kč)", threshold: 50 }
        ];

        const owners = [
            { id: 1, unit: "497/1", name: "Ben-Chenni Zulicha", share: 45 },
            { id: 2, unit: "497/2", name: "Kraus Tomáš", share: 34 },
            { id: 3, unit: "497/3", name: "SJ Hanousek Petr a Kamila", share: 34 },
            { id: 4, unit: "497/4", name: "Stejskalová Terezie", share: 46 },
            { id: 5, unit: "497/5", name: "Švaříček Oldřich", share: 36 },
            { id: 6, unit: "497/6", name: "SJ Kislenko Jan a Zsuzsanna", share: 34 },
            { id: 7, unit: "497/7", name: "Oleksík Zdenek", share: 69 },
            { id: 8, unit: "497/8", name: "Horák Milan", share: 49 },
            { id: 9, unit: "497/9", name: "Jákl Petr Ing. Ph.D.", share: 36 },
            { id: 10, unit: "497/10", name: "Kislenko Zsuzsanna", share: 69 },
            { id: 11, unit: "497/11", name: "Toufar Jiří", share: 34 },
            { id: 12, unit: "497/12", name: "Bednařík Radek", share: 49 },
            { id: 13, unit: "497/13", name: "Bohunský Radek", share: 78 },
            { id: 14, unit: "497/14", name: "Neubauer Richard", share: 35 },
            { id: 15, unit: "497/15", name: "Rapčanová Slavomíra", share: 35 },
            { id: 16, unit: "497/16", name: "SJ Sláma Ladislav a Jana", share: 50 }
        ];

        // --- STATE ---
        let state = {
            mode: 'standard', // 'standard' or 'amendment'
            resolutions: JSON.parse(JSON.stringify(initialResolutions)), // deep copy
            currentIndex: 0,
            amendment: null, // { text: string, threshold: number }
            owners: owners.map(o => ({ ...o, present: false, votedYes: false })),
            history: []
        };

        // --- CORE FUNCTIONS ---

        function init() {
            renderResolutionSelect();
            renderTable();
            updateUI();
            updateHistory();
        }

        function renderResolutionSelect() {
            const select = document.getElementById('resolution-select');
            select.innerHTML = '';
            state.resolutions.forEach((res, index) => {
                const opt = document.createElement('option');
                opt.value = index;
                opt.text = res.modified ? `[UPRAVENO] ${res.title}` : res.title;
                if (res.highlight) opt.className = "font-bold text-red-600 bg-red-50";
                select.appendChild(opt);
            });
            select.value = state.currentIndex;
        }

        function renderTable() {
            const tbody = document.getElementById('owners-table');
            tbody.innerHTML = '';
            
            state.owners.forEach((o, idx) => {
                const tr = document.createElement('tr');
                tr.className = o.present ? "bg-white hover:bg-gray-50 transition-colors" : "bg-gray-100 text-gray-400";
                tr.innerHTML = `
                    <td class="p-3 text-center text-xs font-mono">${idx + 1}</td>
                    <td class="p-3">
                        <div class="font-bold text-blue-900 text-sm">${o.unit}</div>
                        <div class="truncate max-w-[180px] text-xs" title="${o.name}">${o.name}</div>
                    </td>
                    <td class="p-3 text-center text-sm font-mono">${o.share}</td>
                    <td class="p-3 text-center border-l bg-gray-50">
                        <input type="checkbox" class="checkbox-lg accent-gray-600" 
                            ${o.present ? 'checked' : ''} 
                            onchange="setPresence(${idx}, this.checked)">
                    </td>
                    <td class="p-3 text-center border-l ${o.present ? 'bg-blue-50' : ''}">
                        <input type="checkbox" class="checkbox-xl accent-blue-600 disabled:opacity-0" 
                            ${o.votedYes ? 'checked' : ''} 
                            ${!o.present ? 'disabled' : ''}
                            onchange="setVote(${idx}, this.checked)">
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // --- VOTING LOGIC ---

        function setPresence(idx, val) {
            state.owners[idx].present = val;
            if (!val) state.owners[idx].votedYes = false;
            renderTable();
            updateUI();
        }

        function setVote(idx, val) {
            if (!state.owners[idx].present) return;
            state.owners[idx].votedYes = val;
            updateUI();
        }

        function toggleAllPresence(val) {
            state.owners.forEach(o => {
                o.present = val;
                if (!val) o.votedYes = false;
            });
            renderTable();
            updateUI();
        }

        function toggleAllVotes(val) {
            state.owners.forEach(o => {
                if (o.present) o.votedYes = val;
            });
            renderTable();
            updateUI();
        }

        function calculate() {
            const present = state.owners.reduce((acc, o) => o.present ? acc + o.share : acc, 0);
            const votes = state.owners.reduce((acc, o) => (o.present && o.votedYes) ? acc + o.share : acc, 0);
            return { present, votes };
        }

        function updateUI() {
            const { present, votes } = calculate();
            
            // Determine active config
            let currentTitle, threshold;
            if (state.mode === 'amendment') {
                currentTitle = `POZMĚŇOVACÍ NÁVRH: ${state.amendment.text}`;
                threshold = state.amendment.threshold;
            } else {
                const res = state.resolutions[state.currentIndex];
                currentTitle = res.modified ? `${res.title} (ve znění změn)` : res.title;
                threshold = res.threshold;
            }

            // Stats
            const percent = present > 0 ? (votes / present) * 100 : 0;
            const passed = percent > threshold;

            document.getElementById('current-voting-title').textContent = state.mode === 'amendment' ? "POZMĚŇOVACÍ NÁVRH" : state.resolutions[state.currentIndex].title;
            document.getElementById('present-shares').textContent = present;
            document.getElementById('yes-votes').textContent = votes;
            
            // Visuals
            const badge = document.getElementById('result-badge');
            const bar = document.getElementById('progress-bar');
            const status = document.getElementById('status-text');
            const marker = document.getElementById('quorum-marker');
            const qInfo = document.getElementById('quorum-info');

            badge.textContent = percent.toFixed(1) + ' %';
            bar.style.width = percent + '%';
            marker.style.left = threshold + '%';
            qInfo.textContent = `Kvórum: > ${threshold}%`;

            if (present === 0) {
                status.textContent = "ČEKÁNÍ"; status.className = "text-xs font-semibold px-2 py-1 rounded bg-gray-200 text-gray-500";
                badge.className = "px-2 py-1 rounded text-white font-bold text-lg bg-gray-400";
                bar.className = "h-full bg-gray-400";
            } else if (passed) {
                status.textContent = "SCHVÁLENO"; status.className = "text-xs font-semibold px-2 py-1 rounded bg-green-200 text-green-800 animate-pulse";
                badge.className = "px-2 py-1 rounded text-white font-bold text-lg bg-green-600 shadow";
                bar.className = "h-full bg-green-500";
            } else {
                status.textContent = "NEPŘIJATO"; status.className = "text-xs font-semibold px-2 py-1 rounded bg-red-200 text-red-800";
                badge.className = "px-2 py-1 rounded text-white font-bold text-lg bg-red-500 shadow";
                bar.className = "h-full bg-red-500";
            }

            // Mode Styles
            const topBar = document.getElementById('top-bar');
            const amInd = document.getElementById('amendment-indicator');
            const canBtn = document.getElementById('cancel-amendment-btn');
            
            if (state.mode === 'amendment') {
                topBar.classList.remove('bg-blue-900');
                topBar.classList.add('bg-orange-700');
                amInd.classList.remove('hidden');
                canBtn.classList.remove('hidden');
            } else {
                topBar.classList.add('bg-blue-900');
                topBar.classList.remove('bg-orange-700');
                amInd.classList.add('hidden');
                canBtn.classList.add('hidden');
            }
        }

        // --- AMENDMENT WORKFLOW ---

        function openAmendmentModal() {
            toggleModal('amendment-modal');
            document.getElementById('amendment-text').value = '';
            document.getElementById('amendment-text').focus();
        }

        function closeAmendmentModal() {
            toggleModal('amendment-modal');
        }

        function startAmendmentVoting() {
            const text = document.getElementById('amendment-text').value;
            const thresh = parseInt(document.getElementById('amendment-threshold').value);
            
            if (!text.trim()) { alert("Zadejte text změny."); return; }

            state.amendment = { text, threshold: thresh };
            state.mode = 'amendment';
            
            // Clear current votes for the new round
            toggleAllVotes(false);
            
            closeAmendmentModal();
            updateUI();
        }

        function cancelAmendmentMode() {
            if (confirm("Opravdu zrušit hlasování o tomto návrhu? (Hlasy budou ztraceny)")) {
                state.mode = 'standard';
                state.amendment = null;
                toggleAllVotes(false);
                updateUI();
            }
        }

        function changeMainResolution() {
            if (state.mode === 'amendment') {
                if(!confirm("Máte rozdělaný pozměňovací návrh. Chcete ho zahodit a přepnout bod?")) return;
                state.mode = 'standard';
            }
            const sel = document.getElementById('resolution-select');
            state.currentIndex = parseInt(sel.value);
            toggleAllVotes(false);
            updateUI();
        }

        // --- SAVING ---

        function saveRound() {
            const { present, votes } = calculate();
            if (present === 0) { alert("Nelze uzavřít bez přítomných."); return; }

            const percent = (votes / present) * 100;
            
            let passed, threshold, title, type;

            if (state.mode === 'amendment') {
                threshold = state.amendment.threshold;
                passed = percent > threshold;
                title = `ZMĚNA: ${state.amendment.text.substring(0, 50)}...`;
                type = 'amendment';
            } else {
                const res = state.resolutions[state.currentIndex];
                threshold = res.threshold;
                passed = percent > threshold;
                title = res.modified ? `${res.title} (UPRAVENO)` : res.title;
                type = 'standard';
            }

            // Logic: Amendment passed?
            if (type === 'amendment' && passed) {
                if(confirm("Pozměňovací návrh byl PŘIJAT.\n\nMám označit hlavní usnesení jako 'UPRAVENO'?")) {
                    state.resolutions[state.currentIndex].modified = true;
                    renderResolutionSelect();
                }
            }

            // Save to history
            state.history.unshift({
                time: new Date().toLocaleTimeString(),
                title,
                type,
                present,
                votes,
                percent: percent.toFixed(1),
                threshold,
                passed
            });

            updateHistory();

            // Reset
            if (state.mode === 'amendment') {
                state.mode = 'standard';
                state.amendment = null;
            }
            
            toggleAllVotes(false);
            updateUI();
        }

        function updateHistory() {
            const list = document.getElementById('history-list');
            list.innerHTML = '';
            
            state.history.forEach(rec => {
                const isAm = rec.type === 'amendment';
                const row = document.createElement('div');
                row.className = `p-3 ${isAm ? 'bg-orange-50 border-l-4 border-orange-400' : 'bg-white border-l-4 border-blue-400'}`;
                
                row.innerHTML = `
                    <div class="flex justify-between items-start mb-1">
                        <span class="text-xs text-gray-400 font-mono">${rec.time}</span>
                        <span class="px-2 py-0.5 rounded text-[10px] uppercase font-bold text-white ${rec.passed ? 'bg-green-600' : 'bg-red-500'}">
                            ${rec.passed ? 'PŘIJATO' : 'NEPŘIJATO'}
                        </span>
                    </div>
                    <div class="font-bold text-sm text-gray-800 mb-1 leading-tight">
                        ${isAm ? '<span class="text-orange-600">POZMĚŇOVACÍ NÁVRH:</span>' : ''} ${rec.title}
                    </div>
                    <div class="flex justify-between text-xs text-gray-500">
                        <span>Pro: <b>${rec.votes}</b> / Přít: ${rec.present}</span>
                        <span><b>${rec.percent}%</b> (kvórum ${rec.threshold}%)</span>
                    </div>
                `;
                list.appendChild(row);
            });
        }

        function clearHistory() {
            if(confirm("Smazat historii?")) { state.history = []; updateHistory(); }
        }

        // Helper
        function toggleModal(id) {
            const modal = document.getElementById(id);
            if (modal.classList.contains('opacity-0')) {
                modal.classList.remove('opacity-0', 'pointer-events-none');
                document.body.classList.add('modal-active');
            } else {
                modal.classList.add('opacity-0', 'pointer-events-none');
                document.body.classList.remove('modal-active');
            }
        }

        // Start
        init();
    </script>
</body>
</html>
